LMN foreman 1.4.1
============================
lmn-prd-foreman001 ~ # rpm -qa | grep ^fore
foreman-1.4.1-2.el6.noarch
foreman-mysql2-1.4.1-2.el6.noarch
foreman-compute-1.4.1-2.el6.noarch
foreman-vmware-1.4.1-2.el6.noarch


lmn-prd-foreman001 ~ # cat /etc/foreman/settings.yaml 
---
# Managed by puppet

# You must restart the Rack server after changing either of these values
# because they are cached at startup.
#
:unattended: true
:login: true
:require_ssl:  true
:locations_enabled: false
:organizations_enabled: false
#JSONP or "JSON with padding" is a complement to the base JSON data format.
#It provides a method to request JSON data from a server in a different domain.
:support_jsonp: false
#:puppetconfdir: /etc/puppet
#:puppetvardir: /var/lib/puppet

# Mark translated strings with X characters (for developers)
:mark_translated: false
lmn-prd-foreman001 ~ # cat /etc/foreman/database.yml  
# Managed by puppet
#
# Remember to create the foreman database:
# CREATE DATABASE IF NOT EXISTS foreman CHARACTER SET utf8;
# GRANT ALL PRIVILEGES ON foreman.* TO 'foreman'@foreman_hostname_here' IDENTIFIED BY 'add_password_here';
# FLUSH PRIVILEGES;
#
# If the DB server was built using the lmn_role_foreman::db module, then the following script, located on the DB
# server, can be used to create the database: "/root/foreman-database-init.sh"
#
# You then need to rake migrate to use the new schema:
# foreman-rake db:migrate
#

production:
  adapter: mysql2
  database: foreman
  username: foreman
  password: p48Z6o4hP57Xj9A
  host: lmn-prd-mysqlpuppet001.prd.lastminute.com
  pool: 5
  timeout: 5000


lmn-prd-foreman001 ~ # netstat -plant
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   
tcp        0      0 127.0.0.1:45868             0.0.0.0:*                   LISTEN      10203/Passenger Rac 
tcp        0      0 127.0.0.1:38413             0.0.0.0:*                   LISTEN      8957/Passenger Rack 
tcp        0      0 127.0.0.1:45905             0.0.0.0:*                   LISTEN      27709/Passenger Rac 
tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      2128/sshd           
tcp        0      0 127.0.0.1:631               0.0.0.0:*                   LISTEN      2010/cupsd          
tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      2164/sendmail       
tcp        0      0 0.0.0.0:32546               0.0.0.0:*                   LISTEN      10796/f5gs          
tcp        0      0 127.0.0.1:38918             0.0.0.0:*                   LISTEN      29794/Passenger Rac 
 



lmn-prd-foreman001 puppet # cat puppet.conf 
#
# This file is managed by Puppet.
# Do not edit this file manually.
# Any changes will be automatically reverted.
#

[main]
logdir=/var/log/puppet
vardir=/var/lib/puppet
ssldir=/var/lib/puppet/ssl
rundir=/var/run/puppet
factpath=$vardir/lib/facter
templatedir=$confdir/templates
privatekeydir = $ssldir/private_keys { group = service }
hostprivkey = $privatekeydir/$certname.pem { mode = 640 }

[agent]
server=lmn-prd-puppet001.prd.lastminute.com
report=true
pluginsync=true
environment=prd
certname=lmn-prd-foreman001.prd.lastminute.com


lmn-prd-foreman001 foreman # cat config.ru 
# This file is used by Rack-based servers to start the application.

require ::File.expand_path('../config/environment',  __FILE__)
# apply a prefix to the application, if one is defined
# e.g. http://some.server.com/prefix where '/prefix' is defined by env variable
map ENV['RAILS_RELATIVE_URL_ROOT'] || '/'  do
  run Foreman::Application
end


HTTPD CONFIG
lmn-prd-foreman001 conf.d # cat 25-lmn-prd-foreman001.prd.lastminute.com.conf passenger.conf ssl.conf | grep -v ^# | sed '/^$/d
'
<VirtualHost *:80>
    ServerName lmn-prd-foreman001.prd.lastminute.com
    DocumentRoot /usr/share/foreman/public
    PassengerAppRoot /usr/share/foreman
    PassengerRuby /usr/bin/ruby193-ruby
    AddDefaultCharset UTF-8
    <Directory /usr/share/foreman/public>
        <IfVersion < 2.4>
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
    </Directory>
</VirtualHost>
Listen 443
NameVirtualHost *:443
<VirtualHost *:443>
    ServerName lmn-prd-foreman001.prd.lastminute.com
  
    DocumentRoot /usr/share/foreman/public
    PassengerAppRoot /usr/share/foreman
    PassengerRuby /usr/bin/ruby193-ruby
    AddDefaultCharset UTF-8
    <Directory /usr/share/foreman/public>
        <IfVersion < 2.4>
            Allow from all
        </IfVersion>  
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
    </Directory>
    SSLEngine On
    SSLCertificateFile      /var/lib/puppet/ssl/certs/lmn-prd-foreman001.prd.lastminute.com.pem
    SSLCertificateKeyFile   /var/lib/puppet/ssl/private_keys/lmn-prd-foreman001.prd.lastminute.com.pem
    SSLCertificateChainFile /var/lib/puppet/ssl/certs/ca.pem
    SSLCACertificateFile    /var/lib/puppet/ssl/certs/ca.pem
    SSLVerifyClient         optional
    SSLOptions              +StdEnvVars
    SSLVerifyDepth          3
</VirtualHost>
LoadModule passenger_module modules/mod_passenger.so
<IfModule mod_passenger.c>
   PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-4.0.5
   PassengerRuby /usr/bin/ruby
</IfModule>
LoadModule ssl_module modules/mod_ssl.so
AddType application/x-x509-ca-cert .crt
AddType application/x-pkcs7-crl    .crl
SSLPassPhraseDialog  builtin
SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
SSLSessionCacheTimeout  300
SSLMutex default
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
SSLCryptoDevice builtin
<VirtualHost _default_:443>
ErrorLog logs/ssl_error_log
TransferLog logs/ssl_access_log
LogLevel warn
SSLEngine on
SSLProtocol all -SSLv2
SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
SSLCertificateFile /etc/pki/tls/certs/localhost.crt
SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
<Files ~ "\.(cgi|shtml|phtml|php3?)$">
    SSLOptions +StdEnvVars
</Files>
<Directory "/var/www/cgi-bin">
    SSLOptions +StdEnvVars
</Directory>
SetEnvIf User-Agent ".*MSIE.*" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0
CustomLog logs/ssl_request_log \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
</VirtualHost>   



lmn-prd-foreman001 conf.d # cd /usr/lib/ruby/site_ruby/1.8/puppet/reports
lmn-prd-foreman001 reports # ls
http.rb  log.rb  rrdgraph.rb  store.rb  tagmail.rb





